<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icon Components (Replacing lucide-react imports) ---
        const IconBase = ({ children, size = 24, className = "", fill = "none", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill={fill} 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Heart = (props) => (
            <IconBase {...props}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
            </IconBase>
        );

        const Stars = (props) => (
            <IconBase {...props}>
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                <path d="M5 3v4" /><path d="M9 5H1" />
            </IconBase>
        );

        const Sparkles = (props) => (
            <IconBase {...props}>
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
                <path d="M20 3v4" /><path d="M22 5h-4" /><path d="M4 17v2" /><path d="M5 18H3" />
            </IconBase>
        );

        const Frown = (props) => (
            <IconBase {...props}>
                <circle cx="12" cy="12" r="10" />
                <path d="M16 16s-1.5-2-4-2-4 2-4 2" />
                <line x1="9" x2="9.01" y1="9" y2="9" />
                <line x1="15" x2="15.01" y1="9" y2="9" />
            </IconBase>
        );

        const PartyPopper = (props) => (
            <IconBase {...props}>
                <path d="M5.8 11.3 2 22l10.7-3.79" />
                <path d="M4 3h.01" /><path d="M22 8h.01" /><path d="M15 2h.01" /><path d="M22 20h.01" />
                <path d="m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10" />
                <path d="m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17" />
                <path d="m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7" />
            </IconBase>
        );

        const HeartCrack = (props) => (
            <IconBase {...props}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                <path d="m12 13-1-1 2-2-3-3" />
            </IconBase>
        );

        const RefreshCcw = (props) => (
            <IconBase {...props}>
                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                <path d="M3 3v5h5" />
                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" />
                <path d="M16 16h5v5" />
            </IconBase>
        );

        // --- Main App Component ---
        function App() {
            const [noCount, setNoCount] = useState(0);
            const [yesPressed, setYesPressed] = useState(false);
            const [isBroken, setIsBroken] = useState(false);
            const [isShaking, setIsShaking] = useState(false);
            const [noButtonStyle, setNoButtonStyle] = useState({});
            
            // Ref to track if we've already sent the "Opened" event
            const hasOpened = useRef(false);

            // Cap the growth at 3 steps
            const growthStage = Math.min(noCount, 3); 
            const yesButtonSize = growthStage * 8 + 16; 

            const phrases = [
                "No",
                "Playing hard to get? ;)",
                "Really sure?",
                "Think again!",
                "Last chance!",
                "Surely not?",
                "You might regret this!",
                "Give it another thought!",
                "Are you absolutely certain?",
                "This could be a mistake!",
                "Have a heart!",
                "Don't be so cold!",
                "Change of heart?",
                "Wouldn't you reconsider?",
                "Is that your final answer?",
                "You're breaking my heart ;(",
                "Pls? :(",
                "Pretty pls?",
                "Pretty pls with a cherry on top?",
                "Ok fine, I will start over..."
            ];

            const sendResponse = async (selection) => {
                const binId = '6980a49e43b1c97be95fa912';
                const apiKey = '$2a$10$micqb205oYGQstamIKIzkeHFfJ5jhukQsrhQTbPKM5mMD1MUfHkRi';

                try {
                    const payload = {
                        selection,
                        attempts: noCount,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        screen: {
                            width: window.screen.width,
                            height: window.screen.height
                        },
                        window: {
                            width: window.innerWidth,
                            height: window.innerHeight
                        },
                        devicePixelRatio: window.devicePixelRatio
                    };

                    // 1. GET existing data first
                    let existingData = [];
                    try {
                        const getResponse = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                            method: 'GET',
                            headers: {
                                'X-Master-Key': apiKey
                            }
                        });

                        if (getResponse.ok) {
                            const result = await getResponse.json();
                            if (Array.isArray(result.record)) {
                                existingData = result.record;
                            } else if (result.record && typeof result.record === 'object' && Object.keys(result.record).length > 0) {
                                existingData = [result.record];
                            }
                        }
                    } catch (getError) {
                        console.warn('Could not fetch existing records, starting new list:', getError);
                    }

                    // 2. Append new entry
                    const updatedList = [...existingData, payload];

                    // 3. PUT updated list
                    await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                        method: 'PUT', 
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': apiKey
                        },
                        body: JSON.stringify(updatedList)
                    });
                    console.log('Response sent:', selection);
                } catch (error) {
                    console.error('Error sending response:', error);
                }
            };

            // Trigger API call on first load
            useEffect(() => {
                if (!hasOpened.current) {
                    sendResponse('Opened');
                    hasOpened.current = true;
                }
            }, []);

            const handleNoClick = () => {
                if (noCount === phrases.length - 1) {
                    sendResponse('No');
                    setIsBroken(true);
                    return;
                }

                setNoCount(noCount + 1);

                if (noCount >= 2) {
                    setIsShaking(true);
                    setTimeout(() => setIsShaking(false), 400);
                }

                const randomX = Math.floor(Math.random() * 80) + 10; 
                const randomTop = Math.floor(Math.random() * 35) + 5;

                setNoButtonStyle({
                    position: 'absolute',
                    left: `${randomX}%`,
                    top: `${randomTop}%`,
                    transform: `translateX(-${randomX}%)`, 
                    zIndex: 50, 
                });
            };

            const handleYesClick = () => {
                setYesPressed(true);
                sendResponse('Yes');
            };

            const getNoButtonText = () => {
                return phrases[Math.min(noCount, phrases.length - 1)];
            };

            // CSS Confetti Components
            const ConfettiPiece = ({ style }) => (
                <div style={style} className="absolute w-2 h-4 rounded-sm animate-fall opacity-0" />
            );

            const Confetti = () => {
                const pieces = Array.from({ length: 50 }).map((_, i) => {
                    const left = Math.random() * 100;
                    const delay = Math.random() * 2;
                    const duration = Math.random() * 2 + 3;
                    const bg = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#ff9ff3', '#54a0ff'][Math.floor(Math.random() * 5)];
                    
                    return {
                        id: i,
                        style: {
                            left: `${left}%`,
                            top: '-20px',
                            backgroundColor: bg,
                            animation: `fall ${duration}s linear ${delay}s forwards`
                        }
                    };
                });

                return (
                    <div className="fixed inset-0 pointer-events-none z-[100] overflow-hidden">
                        {pieces.map(p => <ConfettiPiece key={p.id} style={p.style} />)}
                    </div>
                );
            };

            // BROKEN UI STATE
            if (isBroken) {
                return (
                    <div className="min-h-screen bg-gray-900 flex flex-col items-center justify-center p-4 font-mono text-gray-400 overflow-hidden relative">
                        <div className="absolute inset-0 bg-black/50 z-0"></div>
                        
                        <div className="z-10 flex flex-col items-center text-center animate-in fade-in zoom-in duration-1000">
                            <div className="relative mb-8 group cursor-not-allowed">
                                <HeartCrack size={120} className="text-red-900/80 animate-pulse drop-shadow-2xl" />
                                <div className="absolute inset-0 text-red-600/50 animate-ping opacity-20">
                                    <HeartCrack size={120} />
                                </div>
                            </div>

                            <h1 className="text-3xl font-bold text-red-700/80 mb-2 tracking-widest uppercase">
                                System Critical
                            </h1>
                            <div className="h-px w-32 bg-red-900/50 my-4"></div>
                            <p className="text-sm text-gray-600 mb-8 max-w-xs">
                                Error 404: Love not found.<br/>
                                The rejection was too strong.<br/>
                                UI has crashed.
                            </p>

                            <button 
                                onClick={() => window.location.reload()}
                                className="group flex items-center gap-2 px-6 py-3 border border-red-900/30 rounded-lg hover:bg-red-900/10 hover:border-red-800/50 transition-all duration-300 text-xs tracking-wider uppercase text-red-800/60 hover:text-red-500"
                            >
                                <RefreshCcw size={14} className="group-hover:rotate-180 transition-transform duration-500" />
                                Reboot Heart.exe
                            </button>
                        </div>

                        <div className="absolute inset-0 pointer-events-none opacity-5 bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-[length:100%_4px]"></div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-pink-100 via-red-50 to-pink-200 flex flex-col items-center justify-center p-4 font-sans text-gray-800 overflow-hidden relative selection:bg-rose-200">
                    
                    <style>{`
                        @keyframes shake {
                            0%, 100% { transform: translateX(0) rotate(0); }
                            25% { transform: translateX(-5px) rotate(-5deg); }
                            75% { transform: translateX(5px) rotate(5deg); }
                        }
                        .animate-shake {
                            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
                        }
                        @keyframes fall {
                            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
                            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
                        }
                    `}</style>

                    {/* Confetti shows on Yes */}
                    {yesPressed && <Confetti />}

                    {/* Background Decor */}
                    <div className="absolute top-10 left-10 text-pink-300 animate-pulse delay-700">
                        <Heart size={48} fill="currentColor" />
                    </div>
                    <div className="absolute bottom-20 right-10 text-rose-300 animate-bounce delay-1000">
                        <Heart size={32} fill="currentColor" />
                    </div>
                    <div className="absolute top-1/4 right-8 text-pink-200 opacity-50">
                        <Stars size={64} />
                    </div>

                    <div className="z-10 w-full max-w-md bg-white/60 backdrop-blur-sm rounded-3xl shadow-xl border border-white/50 p-8 flex flex-col items-center text-center transition-all duration-500 hover:shadow-2xl relative">
                        
                        {yesPressed ? (
                            // SUCCESS STATE
                            <div className="flex flex-col items-center animate-in fade-in zoom-in duration-700">
                                <div className="relative mb-6">
                                    <img 
                                        src="https://media.tenor.com/gUiu1zyxfzYAAAAi/bear-kiss-bear-kisses.gif" 
                                        alt="Bears kissing" 
                                        className="w-48 h-48 object-cover rounded-xl shadow-lg"
                                    />
                                    <Sparkles className="absolute -top-4 -right-4 text-yellow-400 animate-spin-slow" size={40} />
                                    <PartyPopper className="absolute -bottom-4 -left-4 text-pink-500 animate-bounce" size={40} />
                                </div>
                                
                                <h1 className="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-rose-500 to-pink-600 mb-4 tracking-tight">
                                    {noCount === 0 ? "Wow!!" : "Yaaay!!!"}
                                </h1>
                                <p className="text-xl text-gray-700 font-medium mb-6">
                                    {noCount === 0 
                                        ? "You love me so much... wow üò≥üíñ" 
                                        : "I knew you would say yes! ‚ù§Ô∏è"}
                                </p>
                                
                                <div className="bg-white/80 p-4 rounded-xl border border-pink-100 shadow-sm">
                                    <p className="text-sm text-gray-500 italic">
                                        Get ready for the best date ever.
                                    </p>
                                </div>
                            </div>
                        ) : (
                            // ASKING STATE
                            <div className="flex flex-col items-center w-full">
                                <div className="mb-8 relative group">
                                    <div className="absolute inset-0 bg-pink-400 rounded-full blur-2xl opacity-20 group-hover:opacity-30 transition-opacity"></div>
                                    <img 
                                        src="https://media.tenor.com/VIChDQ6ejRQAAAAi/jumping-bear-hearts-no-png.gif" 
                                        alt="Cute bear asking" 
                                        className="relative w-40 h-40 object-contain drop-shadow-sm transition-transform hover:scale-105 duration-300"
                                    />
                                </div>

                                <h1 className="text-3xl md:text-4xl font-bold text-gray-800 mb-2 tracking-tight">
                                    Will you be my Valentine?
                                </h1>
                                <p className="text-gray-500 mb-8 text-sm md:text-base">
                                    I promise to buy you chocolates and flowers üåπ
                                </p>

                                <div className="flex flex-col md:flex-row items-center gap-4 w-full justify-center">
                                    {/* YES BUTTON */}
                                    <button
                                        className={`z-50 relative rounded-full bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold shadow-lg hover:shadow-xl hover:from-rose-600 hover:to-pink-600 transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95 flex items-center justify-center gap-2 ${isShaking ? 'animate-shake' : ''}`}
                                        style={{ 
                                            fontSize: yesButtonSize, 
                                            padding: `${yesButtonSize * 0.5}px ${yesButtonSize}px` 
                                        }}
                                        onClick={handleYesClick}
                                    >
                                        Yes <Heart fill="white" size={yesButtonSize} />
                                    </button>

                                    {/* NO BUTTON */}
                                    <button
                                        onClick={handleNoClick}
                                        style={noButtonStyle}
                                        className="rounded-full bg-gray-100 text-gray-700 font-semibold py-3 px-6 hover:bg-gray-200 transition-all duration-200 shadow-sm border border-gray-200 hover:border-gray-300 text-sm md:text-base flex items-center justify-center gap-2 group max-w-[150px] text-center"
                                    >
                                        {getNoButtonText()}
                                        {noCount > 0 && <Frown size={16} className="min-w-[16px] group-hover:rotate-12 transition-transform" />}
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <footer className="absolute bottom-4 text-xs text-pink-400/80 font-medium">
                        Made with love
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
